%================================================================
% SLO
%----------------------------------------------------------------
% datoteka: 	thesis_template.tex
%
% opis: 		predloga za pisanje diplomskega dela v formatu LaTeX na
% 				Univerza v Ljubljani, Fakulteti za računalništvo in informatiko
%
% pripravili: 	Matej Kristan, Zoran Bosnić, Andrej Čopar,
%			  	po začetni predlogi Gašperja Fijavža
%
% popravil: 	Domen Rački, Jaka Cikač, Matej Kristan
%
% verzija: 		30. september 2016 (dodan razširjeni povzetek)
%================================================================


%================================================================
% SLO: definiraj strukturo dokumenta
% ENG: define file structure
%================================================================
\documentclass[a4paper, 12pt]{book}
 

%================================================================
% SLO: Odkomentiraj "\SLOtrue " za izbiro slovenskega jezika
% ENG: Uncomment "\SLOfalse" to chose English languagge
%================================================================
\newif\ifSLO
\newif\ifTRACKEXIST
\newif\ifTRACKCS
\newif\ifPROGRAMMM

% ---------------------------------------------------------------------------------------
% IMPORTANT: Adjust the thesis language, your study program and course within this block
% ---------------------------------------------------------------------------------------
% switch language
\SLOtrue % Enables Slovenian language
%\SLOfalse  % Enables English language

% switch programs: Computer science and Multimedia. Set to false if the program is in Multimedia
\PROGRAMMMfalse
%\PROGRAMMMtrue

% switch on if your program is divided into tracks CS and DS, otherwise leave it false
% CAUTION: if you were first enrolled into your program before school year 2019/2020, your program is not divided into tracks. In any case, be absolutely sure you select the correct variant. IF IN DOUBT, always contact the student office to advise you.
%
 \TRACKEXISTfalse
%\TRACKEXISTtrue

% default course name is "Computer science" if your course name is "Data science", set the following switch to false
\TRACKCStrue % uncomment if the thesis is from course "Information science"
%\TRACKCSfalse % uncomment if the thesis is from course "Data Science"
% -------------------------------------------------------------------------------------------
% End of language, program and course adjustment
% -------------------------------------------------------------------------------------------


%================================================================
% SLO: vključi oblikovanje in pakete
% ENG: include design and packages
%================================================================
\input{style/thesis_style}

%----------------------------------------------------------------
% |||||||||||||||||||||| USTREZNO POPRAVI |||||||||||||||||||||||
% |||||||||||||||||||||| EDIT ACCORDINGLY |||||||||||||||||||||||
%----------------------------------------------------------------
\newcommand{\ttitle}{Vzorec zaključnega dela}
\newcommand{\ttitleEn}{Thesis template}
\newcommand{\tsubject}{\ttitle}
\newcommand{\tsubjectEn}{\ttitleEn}
\newcommand{\tauthor}{Mojster Jaka}
\newcommand{\temail}{mojster.jaka@gmai.com}
\newcommand{\myyear}{2016}
\newcommand{\tkeywords}{računalnik, računalnik, računalnik}
\newcommand{\tkeywordsEn}{computer, computer, computer}
\newcommand{\mysupervisor}{doc.~dr.\ Peter Klepec}
\newcommand{\mycosupervisor}{akad.~prof.~dr.\ Martin Krpan}

% include formatted front pages
\input{style/thesis_front_pages}

%================================================================
% ENG: main pages of the thesis
%================================================================

% Osnutek magistrske naloge v slovenščini
% (Uporabite v svojem LaTeX slogovnem predlogu)

\chapter{Uvod}


\chapter{Pregled literature in ozadje}

\section{Farmacevtske dobavne verige}
  \subsection{Izzivi sledenja in proti ponarejanju}
  \subsection{Regulativni okvir}
\section{Upravljanje zaupanja v razpršenih sistemih}
  \subsection{Modeli zaupanja}
  \subsection{Zaupanja v IoT in pervasive okolju}
\section{Tehnologija veriženja blokov v dobavnih verigah}
  \subsection{Javne in dovoljene verige blokov}
  \subsection{Pametne pogodbe za nadzor dostopa in sledljivost}
\section{Semantični splet in ontološke metode}
  \subsection{RDF, OWL in orodja za ontologijo}
  \subsection{Ontologija zaupanja}
\section{Analiza vrzeli in prispevek te naloge}
\section{Zaupanje}
\section{Ontologija zaupanja}
  \subsection{Koncepti in odnosi}
  \subsection{SWRL pravila}
  \subsection{Mehanizem razumevanja (angl. Reasoning Mechanism)}
\section{Pametne pogodbe in pametni orakli}

\chapter{Implementacija sistema}

\section{Arhitektura sistema}

Arhitektura sistema za upravljanje zaupanja v farmacevtski dobavni verigi je sestavljena iz več plasti. Te omogočajo kombinacijo semantičnih podatkov, subjektivne ocene zaupanja in decentraliziranega shranjevanja rezultatov v verigo blokov. Z delitvijo sistema na plasti omogočamo modularnost, večjo preglednost in lažjo implementacijo nadaljnjih razširitev.

Arhitekturo razdelimo na tri plasti, katere bodo podrobneje opisane v naslednjih podpoglavjih:

\begin{enumerate}
    \item \textbf{Plast znanja} \\
    V tej plasti se nahajajo vse ontološke definicije, primerki akterjev in njihove lastnosti. Sem spada tudi konceptualna zasnova lastnosti zaupanja, kot so licence, temperaturne nepravilnosti, točnost dostave ipd.

    \item \textbf{Mehanizem za sklepanje zaupanja} \\
    Ta plast vključuje sistem za izvajanje ocenjevanja zaupanja. Združuje podatke iz ontologije in pravil zaupanja ter izvede sklepanje za vsak par entitet. Rezultat je preslikava razmerja zaupanja med akterji, ki je pripravljena za zapis v verigo blokov.

    \item \textbf{Graf zaupanja na verigi blokov} \\
    Zadnja plast predstavlja pametno pogodbo, ki beleži razmerja zaupanja med entitetami. Shranjevanje rezultatov v verigo blokov omogoča transparentnost, trajnost in decentralizirano preverljivost zaupanja. 
\end{enumerate}

\noindent
Na sliki~\ref{fig:architecture-diagram} je prikazan arhitekturni pregled sistema.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Arhitektura-trust-management.png}
    \caption{Večplastna arhitektura sistema za upravljanje zaupanja}
    \label{fig:architecture-diagram}
\end{figure}

\newpage

\subsection{Plast znanja}
Plast znanja (angl. Knowledge Layer) definira semantično strukturo akterjev, njihove značilnosti in nabor pravil za individualno ocenjevanje zaupanja. V osnovi jo sestavljata dve ključni komponenti: ontologija in pravila zaupanja posameznih akterjev.

\paragraph{Ontologija}
Ontologija v jeziku OWL predstavlja formalno definiran model, ki vključuje vse vrste entitet, ki sodelujejo v farmacevtski dobavni verigi (npr. \textit{Proizvajalec}, \textit{Lekarna}, \textit{Prevoznik}, \textit{Regulator}). Vsaka vrsta entitete ima lahko specifične lastnosti, ki jih sistem uporablja pri sklepanju o zaupanju, kot so na primer:

\begin{itemize}
    \item \texttt{hasDeliveryPunctuality} - točnost dostave,
    \item \texttt{hasTempViolationRate} - stopnja temperaturnih odstopanj,
    \item \texttt{hasLicense} - podatek o veljavni licenci,
    \item \texttt{hasGMP} - skladnost s proizvodnimi standardi GMP \cite{nally2016good},
    \item \texttt{hasAuditScore} - rezultat presoje kakovosti.
\end{itemize}

Ontologija je zapisana v formatu RDF \cite{w3crdfconcepts} zasnovan na označevalnem jeziku XML \cite{w3crdfxml}, ki omogoča enostavno obdelavo s knjižnico \texttt{rdflib} \cite{rdflib} v programskem jeziku Python. Na ta način lahko sklepanje temelji na aktualnih podatkih, zapisanih v ontološkem grafu, brez potrebe po relacijski bazi ali ročnem povezovanju.

Na sliki \ref{fig:ontology-export} vidimo vse akterje v ontologiji predstavljene v programu Protege.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figures/export-pharma-trust.png}
    \caption{Akterji ontologije v programu Protege}
    \label{fig:ontology-export}
\end{figure}

V ontologiji so definirani tudi posamezni primerki entitet (npr. \textit{Pfizer}, \textit{DHL}, \textit{MediPlus}), skupaj z njihovimi lastnostmi. To omogoča sistemu, da na podlagi resničnih podatkov izvede evalvacijo zaupanja.

\paragraph{Pravila zaupanja posameznih akterjev}

Vsaka entiteta v sistemu lahko definira svoja lastna pravila zaupanja, ki opisujejo pogoje, pod katerimi določena entiteta zaupa drugi. Ta pravila so zapisana v berljivi in strukturirani obliki JSON, kar omogoča enostavno vključevanje v mehanizem sklepanja.

Primer politike pravil zaupanja za entiteto \textit{Pfizer} je prikazan v spodnjem zapisu v formatu JSON:

\begin{verbatim}
{
  "actor": "http://example.org/trust#Pfizer",
  "trusts": {
    "Transporter": {
      "hasDeliveryPunctuality": { "gte": 0.9 },
      "hasTempViolationRate": { "lte": 0.05 }
    }
  }
}
\end{verbatim}

Zapis pove, da entiteta \textit{Pfizer} zaupa samo tistim prevoznikom, ki dosegajo vsaj 90\,\% pravočasnih dostav (\texttt{hasDeliveryPunctuality~$\geq$~0.9}) in katerih delež temperaturnih odstopanj pri transportu zdravil ne presega 5\,\% (\texttt{hasTempViolationRate~$\leq$~0.05}). Na ta način se pravila zaupanja natančno preslikajo v merljive pogoje, ki temeljijo na lastnostih, definiranih v ontologiji.

Mehanizem sklepanja nato uporabi ta pravila za vsako entiteto, s katero obravnavani akter vzpostavi zaupanje ter preveri, ali so pogoji izpolnjeni.

Ker so pravila zapisana v JSON obliki, je možno preprosto razviti uporabniški vmesnik, kjer lahko predstavnik podjetja (npr. administrator lekarne ali regulatorja) preko obrazca določil svoje kriterije za zaupanje. Vmesnik bi generiral JSON strukturo na podlagi definiranih lastnosti v ontologiji. To nam omogoča visoko stopnjo prilagodljivosti in enostavne uporabe brez tehničnega predznanja.

JSON pravila služijo kot most med semantičnim modelom in subjektivno presojo vsakega akterja. Tako omogočamo personalizirano ocenjevanje zaupanja.

\subsection{Mehanizem za sklepanje zaupanja (angl. Trust Resolution Engine)}

Mehanizem za sklepanje zaupanja predstavlja osrednjo logično plast sistema, kjer se združujejo podatki iz ontologije in pravila zaupanja posameznih akterjev. Tukaj se izvede proces ocenjevanja, ki določi, ali določena entiteta zaupa drugi glede na pogoje, zapisane v pravilih zaupanja posameznega akterja.

\paragraph{Delovanje mehanizma}
Python modul, razvit za potrebe sistema, izvaja naslednje korake:
\begin{enumerate}
    \item Naloži ontologijo (OWL/RDF) in iz nje izlušči podatke o vseh akterjih ter njihovih lastnostih.
    \item Prebere pravila zaupanja vsakega akterja, ki so zapisana v JSON formatu.
    \item Za vsak par (ocenjevalec in tisti, ki je ocenjen) preveri, ali vrednosti atributov ocenjenega akterja ustrezajo pravilom ocenjevalca.
    \item Rezultate ocenjevanja shrani v zbirko rezultatov (CSV datoteka) in jih pripravi za zapis v verigo blokov.
\end{enumerate}

\paragraph{Primer ocenjevanja}
Če ima npr. akter \textit{Pfizer} pravilo, da zaupa le prevoznikom z vsaj 90\,\% točnih dostav in manj kot 5\,\% temperaturnimi nepravilnostmi, bo mehanizem preveril te pogoje za vsakega prevoznika, zapisanega v ontologiji. Rezultat ocenjevanja je binarna odločitev (\texttt{true/false}), ki pove, ali akter izpolnjuje kriterije zaupanja.

\subsection{Graf zaupanja na verigi blokov (angl. Blockchain Trust Registry)}

Zadnja plast arhitekture je namenjena trajnemu in preverljivemu beleženju rezultatov ocenjevanja zaupanja. To dosežemo z uporabo pametne pogodbe na verigi blokov, ki deluje kot decentraliziran register zaupanja (angl. \textit{trust registry}).

\paragraph{Struktura pametne pogodbe}
Pametna pogodba vsebuje podatkovno strukturo, ki beleži relacije zaupanja med akterji v obliki:
\[
    (akter1, akter2) \mapsto status\_zaupanja
\]
kjer je \texttt{status\_zaupanja} logična vrednost (\texttt{true/false}), ki označuje, ali akter 1 zaupa akterju 2.

\paragraph{Funkcionalnosti}
Pametna pogodba omogoča naslednje osnovne funkcije:
\begin{itemize}
    \item \texttt{setTrustStatus()} --- zapis oziroma posodobitev rezultata zaupanja na verigi blokov.
    \item \texttt{isTrusted()} --- preverjanje, ali določen akter zaupa drugemu.
    \item \texttt{event TrustUpdated} --- beleženje dogodkov o spremembi zaupanja za transparentnost in enostavno spremljanje.
\end{itemize}

\section{Orodja in razvojno okolje}
\section{Ontologija in orodja za sklepanje}

\subsection{Ontologija zaupanja}

Ontologija zaupanja je osnovni gradnik sistema, saj omogoča formaliziran opis vseh akterjev v farmacevtski dobavni verigi ter njihovih lastnosti. Zasnovana je v jeziku OWL. Glavni namen ontologije je, da lahko vse akterje opišemo na enoten način in jih obogatimo s podatki, ki so pomembni za ocenjevanje zaupanja.

\subsubsection{Razredi akterjev}

V ontologiji so definirani osnovni razredi, ki predstavljajo tipe akterjev. To so proizvajalec, distributer, lekarna, prevoznik in regulator. Vsi ti razredi so podrazredi splošnega razreda \texttt{Actor}, kar pomeni, da jih lahko obravnavamo skupaj, ko govorimo o celotni verigi. Vsak tip akterja ima svoje značilne lastnosti. Na primer, proizvajalci imajo lastnost \texttt{hasGMP}, ki pove, ali imajo veljavno GMP skladnost, prevozniki imajo lastnosti \texttt{hasDeliveryPunctuality} in \texttt{hasTempViolationRate}, lekarne pa lastnost \texttt{hasPrescriptionComplianceRate}.

\subsubsection{Lastnosti zaupanja}

Lastnosti opisujejo merljive kriterije, ki se uporabljajo pri presoji zaupanja. Nekaj primerov:
- \texttt{hasGMP} opisuje ali je proizvajalec skladen z dobrimi proizvodnimi praksami,
- \texttt{hasAuditScore} predstavlja oceno presoje kakovosti,
- \texttt{hasLicense} označuje, ali ima akter veljavno licenco,
- \texttt{hasDeliveryPunctuality} izraža delež pravočasnih dostav,
- \texttt{hasTempViolationRate} pove, kolikšen delež transportov je imel temperaturna odstopanja,
- \texttt{hasPrescriptionComplianceRate} opisuje skladnost lekarne pri izdaji zdravil na recept,
- \texttt{hasIssuedCertifications} je število certifikatov, ki jih je regulator izdal,
- \texttt{hasJurisdictionLevel} pa določa raven pristojnosti regulatorja (npr. lokalna, nacionalna, globalna).

\subsubsection{Razredi zaupanja}

Za vsak tip akterja so v ontologiji definirani tudi posebni razredi, ki predstavljajo zaupanja vredne entitete. To so na primer \texttt{TrustedManufacturer}, \texttt{TrustedDistributor}, \texttt{TrustedPharmacy}, \texttt{TrustedTransporter} in \texttt{TrustedRegulatoryAuthority}. Ti razredi so definirani z ekvivalenčnimi pogoji, kar pomeni, da reasoner lahko samodejno uvrsti entiteto v določen zaupanja vreden razred, če so pogoji izpolnjeni. Na primer, proizvajalec, ki ima GMP certifikat in dovolj visoko oceno presoje kakovosti, bo klasificiran kot \texttt{TrustedManufacturer}. Podobno velja za druge tipe akterjev.

\subsubsection{Primerki akterjev}

V ontologijo so dodani tudi konkretni primerki, ki predstavljajo dejanske akterje v sistemu. Tako imamo na primer proizvajalca Pfizer in Novartis, prevoznika DHL, lekarno MediPlus, distributerja EuroLogistics ter regulatorja EMA. Vsak od teh primerkov ima določene lastnosti, kot so na primer ocena presoje, točnost dostave ali število izdanih certifikatov. Te vrednosti se potem uporabijo pri sklepanju o zaupanju.


\section{Razvoj pametnih pogodb in oraklov}
\section{Uporabniški vmesnik in API-ji}

\chapter{Evalvacija}
\section{Varnostna analiza}
\section{Zmogljivost in razširljivost}
\section{Natančnost ocene zaupanja}
\section{Prednosti in omejitve}
\section{Primerjava z obstoječimi rešitvami}
\section{Pridobljena spoznanja}

\chapter{Zaključek in nadaljnje delo}
\section{Povzetek prispevkov}
\section{Nadaljnje raziskave}

\appendix
\chapter{Shema ontologije in SWRL pravila}
\chapter{Izvlečki kode pametnih pogodb}

%----------------------------------------------------------------
% SLO: bibliografija
% ENG: bibliography
%----------------------------------------------------------------
\bibliographystyle{elsarticle-num}

%----------------------------------------------------------------
% SLO: odkomentiraj za uporabo zunanje datoteke .bib (ne pozabi je potem prevesti!)
% ENG: uncomment to use .bib file (don't forget to compile it!)
%----------------------------------------------------------------
\bibliography{bibliography}

%----------------------------------------------------------------
% SLO: zakomentiraj spodnji del, če uporabljaš zunanjo .bib datoteko
% ENG: comment the part below if using the .bib file
%----------------------------------------------------------------

%\begin{thebibliography}{99}
%\bibitem{Fortnow} L.\ Fortnow, ``Viewpoint: Time for computer science to grow up'',
%{\it Communications of the ACM}, št.\ 52, zv.\ 8, str.\ 33--35, 2009.
%\bibitem{Knuth} D.\ E.\ Knuth, P. Bendix. ``Simple word problems in universal algebras'', v zborniku: Computational Problems in Abstract Algebra (ur. J. Leech), 1970, str. 263--297.
%\bibitem{Lamport} L.\ Lamport. {\it LaTEX: A Document Preparation System}. Addison-Wesley, 1986.
%\bibitem{ubi} O.\ Patashnik (1998) \BibTeX{}ing.
%Dostopno na: \url{http://ftp.univie.ac.at/packages/tex/biblio/bibtex/contrib/doc/btxdoc.pdf}
%\bibitem{licence} licence-cc.pdf. Dostopno na: \url{https://ucilnica.fri.uni-lj.si/course/view.php?id=274}
%\end{thebibliography}

\end{document}
